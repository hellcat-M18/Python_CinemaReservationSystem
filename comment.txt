追加機能についての解説

今回オリジナルで追加した機能は以下の通りです。
1. Adminとして映画をCLIから管理する機能
2. チケット購入時にUUIDを持つQRコードを表示する機能
3. QRコードを用いた予約内容の確認&改札機能(QRリーダーが使えないので不完全)

現実におけるユースケースを考え、Admin/User側ともに最低限のCRUD操作を実現することを目標としました。
SQLiteを使ってDBを構築したことにより、こうした目標に必要な操作の実現が容易になりました。

---
改善を求められるとしたら？

1. 操作性
今回の課題では、Google Colab上で動き、かつ最小限のリソースで動かすことを目的としたため、CLIツールとしての開発に努めました。
しかしながら、実際の用途ではカーソルやクリックなどによる、より直感的な操作性が求められると思います。
より実用的なシステムを作るなら、TUI、あるいはGUIでの構築がベターなように感じました。

2. 日程や時間の表示形式
特にAdmin側で映画を登録する際に、本来ならばGoogle Calenderのように時間軸を伴うカレンダー形式での表示があると便利なのですが、
実装コストが重くなりそうで今回は断念しました。
次に作るときはライブラリなどの力を借りてチャレンジしてみたいです。

3. 全体的な融通の利かなさ
今回はまだ最低限のロジックしか実装しきれていないため、個別の上映回に対する変更や削除が出来ません。
実運用では確実にこうした操作が必要になると考えられるため、より良いものにするには避けて通れないと思います。
ただそれを実装するには、そもそもCLIだと厳しいようにも思うので、次回以降に向けた教訓として活かしていきたいです。

4. ロギング機能
現状このシステムにはログを出力する機能がありません。
何かあった時の対応策としてあるに越したことは無いので、改善点の一つだと思います。

5. ユーザー名・パスワードの変更機能
現状は一度ユーザーアカウントの登録を済ませたら、それ以降名前などを変更する方法がありません。
これ以上複雑化するのも嫌なので今回は実装しませんでしたが、実際の運用では要求される機能の一つだと思います。

6. アカウントシステムのセキュリティ
今はオーソドックスなID/パスワード認証に留めていますが、実際の運用では簡単に突破されてしまう可能性が高いです。

---
生成AIに書いてもらって、自分では思いつかなかったコードについて。

割と終始GitHub Copilotと相談しながら進めてました。
最初に処理の流れを最低限自分で考えて、そこからブラッシュアップする形だと、流れを把握しやすく効率的に感じました。
大枠を提示して、細かい部分を突いてもらうといった用途が多かったです。

1. QRコードのジェネレーター
colab上で普通に表示すると形が崩れる現象に悩まされていたが、rich.console.printを使うことで解決した。

2. DBテーブルのひな型
処理に必要と考えられるデータ項目を一旦自分でまとめ、それをもとに実用的なテーブル設計を行い、SQLAlchemyを用いたDBテーブル作成までの処理を書いてもらった。
テーブル設計についてまだ効率的なやり方分かっておらず、特にリレーションなどの使い方が身についていないため、これを参考に知見を広げていきたい。

3. 入力待ちの方式
待機する箇所をwhile(true)でかこって、成功したらreturn, 失敗したらループの頭から、という書き方が気に入った。 
簡潔で分かりやすいいいロジックだと思う。

4. DBにおける日付の扱い方
曰くSQLiteは日付データを結局数値で持つような実装になっているとのことで、わざわざ専用の型を使うメリットがあまりないとのこと。
今までMySQLやPostgreSQLしか使ったことが無かったので知らなかった。

5. サンプルデータの投入
サンプルデータの生成スクリプトは、以下の要件のもと全面的にAIに任せた。

・映画5本
・今日から2か月分
・週1の繰り返し
・平日の月から金まで順番に

人力で組むとそれなりに時間を要するので、Aiに任せるのは悪くない選択肢だと思う。

6. docstring
今まで見たことのない書き方だった。
コメントと違いhelp()関数などで実際に外部から参照されることがある実用的な書き方だと後から知った。
(最初はコメントとの違いが分からず、コメントアウトに直してしまっていた)

7. Google Colab環境か否かの判定
Colab固有の環境変数を見ることで実現していて、分かりやすくいいアプローチだと感じた。

8. 以下のような書き方
_run(
    [runner_py, "-c", "from db.db import init_db; init_db(); print('OK: created tables')"],
    cwd=root_dir,
)
オプションに"-c"を指定することで一行のコードを実行させることができるのは初めて知った。
簡単な処理をコード内で実行するのに便利だと感じた。


---

感想
ただGradioを使ってGUIで動かすのもつまらないので、要件をシンプルに満たすCLIとして作りました。
多少知識があってやりやすそうだったので、中身はWebアプリみたいにルーター型にしました。

生成してもらったコードに自分でコメントを付けていくと、自分なりに処理の中身を整理することが出来て便利に感じました。
ただ労力的に、あくまで小規模なプロジェクトでしか使えない手なので、もう少し効率的なやり方を見つけたいところです。

処理の実装にあたって、全体的にGUIの優位性を強く感じました。
デザイン面で考えることが増えるので、私はあまり得意ではないのですが、制約がCLIに比べて少ないのは明確なメリットだと思います。
